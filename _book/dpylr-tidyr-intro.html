<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EpidemiaR Introductory Materials - Data manipulation with *dplyr* and *tidyr*</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./joins.html" rel="next">
<link href="./pipes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dpylr-tidyr-intro.html">Data manipulation with <code>*dplyr*</code> and <code>*tidyr*</code></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EpidemiaR Introductory Materials</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./base-r-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R and Rstudio and basic functions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./if-statements.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Using <code>if</code> statements</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./more-base.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">More base R functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chaining multiple steps using pipes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dpylr-tidyr-intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data manipulation with `*dplyr*` and `*tidyr*`</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Joining data in tidyverse</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-power-of-packages" id="toc-the-power-of-packages" class="nav-link active" data-scroll-target="#the-power-of-packages">The power of packages</a>
  <ul class="collapse">
  <li><a href="#installing-and-loading-packages" id="toc-installing-and-loading-packages" class="nav-link" data-scroll-target="#installing-and-loading-packages">Installing and loading packages</a></li>
  </ul></li>
  <li><a href="#reading-data-into-r" id="toc-reading-data-into-r" class="nav-link" data-scroll-target="#reading-data-into-r">Reading data into R</a>
  <ul class="collapse">
  <li><a href="#inspecting-data" id="toc-inspecting-data" class="nav-link" data-scroll-target="#inspecting-data">Inspecting data</a></li>
  </ul></li>
  <li><a href="#data-manipulation-using-tidyverse" id="toc-data-manipulation-using-tidyverse" class="nav-link" data-scroll-target="#data-manipulation-using-tidyverse">Data manipulation using <code>*tidyverse*</code></a>
  <ul class="collapse">
  <li><a href="#selecting-columns-and-filtering-rows" id="toc-selecting-columns-and-filtering-rows" class="nav-link" data-scroll-target="#selecting-columns-and-filtering-rows">Selecting columns and filtering rows</a></li>
  <li><a href="#working-with-dates-using-the-lubridate-package" id="toc-working-with-dates-using-the-lubridate-package" class="nav-link" data-scroll-target="#working-with-dates-using-the-lubridate-package">Working with dates using the <code>*lubridate*</code> package</a></li>
  <li><a href="#creating-new-columns-with-mutate" id="toc-creating-new-columns-with-mutate" class="nav-link" data-scroll-target="#creating-new-columns-with-mutate">Creating new columns with <code>mutate()</code></a></li>
  </ul></li>
  <li><a href="#use-pipes-to-combine-steps" id="toc-use-pipes-to-combine-steps" class="nav-link" data-scroll-target="#use-pipes-to-combine-steps">Use Pipes to combine steps</a>
  <ul class="collapse">
  <li><a href="#grouping-and-summarizing-data" id="toc-grouping-and-summarizing-data" class="nav-link" data-scroll-target="#grouping-and-summarizing-data">Grouping and summarizing data</a></li>
  </ul></li>
  <li><a href="#reshaping-data-with-tidyr" id="toc-reshaping-data-with-tidyr" class="nav-link" data-scroll-target="#reshaping-data-with-tidyr">Reshaping data with <code>*tidyr*</code></a></li>
  <li><a href="#final-exercises" id="toc-final-exercises" class="nav-link" data-scroll-target="#final-exercises">Final exercises</a></li>
  <li><a href="#function-cheatsheet" id="toc-function-cheatsheet" class="nav-link" data-scroll-target="#function-cheatsheet">Function cheatsheet</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data manipulation with <code>*dplyr*</code> and <code>*tidyr*</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="the-power-of-packages" class="level2">
<h2 class="anchored" data-anchor-id="the-power-of-packages">The power of packages</h2>
<p>One of the great things about using R are the thousands of available packages, which provide additional functions for many analytical tasks, such as data cleaning, statistical modelling, mapping, and much more. R packages are open-source, which means that they are free to use and maintained by the R community.</p>
<section id="installing-and-loading-packages" class="level3">
<h3 class="anchored" data-anchor-id="installing-and-loading-packages">Installing and loading packages</h3>
<p>Throughout the rest of the workshop we will use a set of R packages manipulating data and creating plots and maps. As we covered in the Day 1 lesson, we first need to install the package on our computer using the <code>install.packages()</code> function. This only needs to be done one time (you probably already did this earlier).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the package has been installed, we can load it into our current R session using the <code>library()</code> function. Unlike installing, you will need to load the library each time you want to use it. This is because some libraries may have functions with the same names as other libraries or as our variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the next series of exercises, we will be using a group of packages which have been designed to work together to do common data science tasks. This <a href="https://www.tidyverse.org/">group of packages is called the “Tidyverse”</a>, because it is designed to work within the <a href="https://r4ds.had.co.nz/tidy-data.html#tidy-data-1">“tidy” data philosophy</a>:</p>
<!-- [![](https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png "Tidy data")](https://r4ds.had.co.nz/tidy-data.html#tidy-data) -->
<p><img src="hs_images/02_tidy-1.png" class="img-fluid"></p>
<p>Some important qualities of this philosophy is that our data should have the following format:</p>
<ol type="1">
<li>Each column should be a single variable with one data type.</li>
<li>Each row should be a single observation.</li>
<li>Each cell should be a single value contains <strong>one</strong> piece of information.</li>
</ol>
<p>We can install all of these packages at once using <code>install.package("tidyverse")</code>. Remember that we only install the package once, so it is actually better to type this directly into the console instead of in our R script since it does not need to be repeated. Also be aware that this may take some time especially if internet quality is poor. After the package has finished installing it is ready to be loaded into our R session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="reading-data-into-r" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-into-r">Reading data into R</h2>
<p>Once the <strong><code>tidyverse</code></strong> package is loaded into our session we will have access to all of the functions in each of the Tidyverse packages. This includes packages for loading, manipulating, and plotting data. The function we will use is <code>read_csv()</code> to read in the woreda-level data we worked with previously. Note that this is <a href="https://r4ds.had.co.nz/data-import.html#compared-to-base-r">similar but slightly different to the read.csv()</a> function we used in our previous exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/training_case_data_long.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the same dataset we used in the Day 1 workshop, only this time we called the object <code>case_data</code> instead of <code>dat</code>. It’s good practice to name your objects something short and meaningful, so that it’s easy to type and remember (this is especially useful when you have multiple data objects).</p>
<p>Also, in this file the data are organized in “long” format, whereas the file used in Day 1 was in “wide” format. We will discuss the difference between “long” and “wide” formatted data in today’s material, as well as how to change the shape of our data.</p>
<section id="inspecting-data" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-data">Inspecting data</h3>
<p>Like in the previous exercise, we can use the <code>head()</code> and <code>summary()</code> functions to view aspects of the dataframe. We can also use the <code>view()</code> function to open the entire file in the R Studio Viewer, however view large files (millions of rows) can cause R Studio to crash. We can also install additional packages, such as <strong><code>skimr</code></strong> to get an even more detailed summary (run <code>install.package("skimr")</code> in your console).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(case_data)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(case_data)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(case_data)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Using skimr package, remember to install first!</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(case_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- \textcolor{red}{Question 1: How many rows and columns are in case_data?} -->
<!-- \textcolor{red}{Question 2: What "type" of data are each column (character, vector, etc.)?} -->
<blockquote class="blockquote">
<p>Question 1: How many rows and columns are in case_data?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 2: What “type” of data are each column (character, vector, etc.)?</p>
</blockquote>
</section>
</section>
<section id="data-manipulation-using-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="data-manipulation-using-tidyverse">Data manipulation using <code>*tidyverse*</code></h2>
<p>In the Day 1 workshop we learned some built-in functions, or “base” functions, for simple data manipulations such as selecting a specific column or filter for only rows that match some criteria. In this lesson we will learn the <code>*tidyverse*</code> approach to these and additional common data manipulation tasks, using two packages called <code>*dplyr*</code> and <code>*tidyr*</code>. The <code>*dplyr*</code> package provides functions for the most common data manipulations jobs, and the <code>*tidyr*</code>package provides functions for reshaping or pivoting dataframes (similar to pivot tables in Microsoft Excel).</p>
<section id="selecting-columns-and-filtering-rows" class="level3">
<h3 class="anchored" data-anchor-id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows</h3>
<p>To select a specific column from a dataframe, use the <code>select()</code> function. The first argument will always be the dataframe object that you’re working with, followed by the name(s) of the column or columns you want to select.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select just one column (region)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, region)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select multiple columns</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, woreda, data_type, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To select all the columns <strong>except</strong> certain ones, you can use a <code>-</code> in front of the column name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all but one column</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, <span class="sc">-</span>region)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing multiple columns</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, <span class="sc">-</span>period, <span class="sc">-</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To choose specific rows based on some criteria, use <code>filter()</code>. Again, the first argument will be the dataframe, then the following argument will be the condition that we want use to subset the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32,064 × 7
   region zone               woreda  year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;              &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Oromia Horo Gudru Wellega Ababo   2018 2018-01-01 confirmed    NA
 2 Oromia Horo Gudru Wellega Ababo   2018 2018-02-01 confirmed    NA
 3 Oromia Horo Gudru Wellega Ababo   2018 2018-03-01 confirmed    NA
 4 Oromia Horo Gudru Wellega Ababo   2018 2018-04-01 confirmed    NA
 5 Oromia Horo Gudru Wellega Ababo   2018 2018-05-01 confirmed    NA
 6 Oromia Horo Gudru Wellega Ababo   2018 2018-06-01 confirmed    NA
 7 Oromia Horo Gudru Wellega Ababo   2018 2018-07-01 confirmed    16
 8 Oromia Horo Gudru Wellega Ababo   2018 2018-08-01 confirmed    83
 9 Oromia Horo Gudru Wellega Ababo   2018 2018-09-01 confirmed    35
10 Oromia Horo Gudru Wellega Ababo   2018 2018-10-01 confirmed   167
# ℹ 32,054 more rows</code></pre>
</div>
</div>
<p>Notice here that just like in Day 1 use have to use a <code>==</code> sign for setting a condition. You can read this as saying, “choose the rows in <code>case_data</code> where region is equal to”Oromia”. Also notice that the number of rows in the object has gone down from 94176 to 32064.</p>
<p>We can filter on multiple conditions at once using multiple arguments, using a <code>,</code> to state separate conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span>, data_type <span class="sc">==</span> <span class="st">"presumed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,032 × 7
   region zone               woreda  year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;              &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Oromia Horo Gudru Wellega Ababo   2018 2018-01-01 presumed     NA
 2 Oromia Horo Gudru Wellega Ababo   2018 2018-02-01 presumed     NA
 3 Oromia Horo Gudru Wellega Ababo   2018 2018-03-01 presumed     NA
 4 Oromia Horo Gudru Wellega Ababo   2018 2018-04-01 presumed     NA
 5 Oromia Horo Gudru Wellega Ababo   2018 2018-05-01 presumed     NA
 6 Oromia Horo Gudru Wellega Ababo   2018 2018-06-01 presumed     NA
 7 Oromia Horo Gudru Wellega Ababo   2018 2018-07-01 presumed     NA
 8 Oromia Horo Gudru Wellega Ababo   2018 2018-08-01 presumed     NA
 9 Oromia Horo Gudru Wellega Ababo   2018 2018-09-01 presumed     NA
10 Oromia Horo Gudru Wellega Ababo   2018 2018-10-01 presumed     NA
# ℹ 16,022 more rows</code></pre>
</div>
</div>
<p>By default, each of the conditions in <code>filter()</code> must be TRUE to remain in the subset, however there are special operators that allow for more complex conditional operations. The most common are the AND (<code>&amp;</code>) and OR (<code>|</code>) operators. Here are some examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># region is Easter AND data type is presumed </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span> <span class="sc">&amp;</span> data_type <span class="sc">==</span> <span class="st">"presumed"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># region is Oromia OR data type is presumed </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span> <span class="sc">|</span> data_type <span class="sc">==</span> <span class="st">"presumed"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># region is Afar OR Oromia, AND count is over 1,000</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Afar"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Oromia"</span>, count <span class="sc">&gt;</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- > $\color{red}{\text{Question 3: Why did we not use & in the third example?}}$ -->
<blockquote class="blockquote">
<p>Question 3: Why did we not use &amp; in the third example?</p>
</blockquote>
<p>Another useful operator is the MATCH operator (<code>%in%</code>), which will return TRUE if a value matches any value in a list of possible options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep rows where data type could be presumed or confirmed</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"presumed"</span>, <span class="st">"confirmed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 94,176 × 7
   region zone     woreda     year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Somali Shabelle Aba-Korow  2018 2018-01-01 confirmed    NA
 2 Somali Shabelle Aba-Korow  2018 2018-02-01 confirmed    NA
 3 Somali Shabelle Aba-Korow  2018 2018-03-01 confirmed    NA
 4 Somali Shabelle Aba-Korow  2018 2018-04-01 confirmed    NA
 5 Somali Shabelle Aba-Korow  2018 2018-05-01 confirmed    NA
 6 Somali Shabelle Aba-Korow  2018 2018-06-01 confirmed    NA
 7 Somali Shabelle Aba-Korow  2018 2018-07-01 confirmed    21
 8 Somali Shabelle Aba-Korow  2018 2018-08-01 confirmed    13
 9 Somali Shabelle Aba-Korow  2018 2018-09-01 confirmed    37
10 Somali Shabelle Aba-Korow  2018 2018-10-01 confirmed    20
# ℹ 94,166 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep rows from a group of selected woredas</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>study_woredas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Adama Town"</span>, <span class="st">"Liban Jawi"</span>, <span class="st">"Mieso"</span>, <span class="st">"Wondo"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, woreda <span class="sc">%in%</span> study_woredas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 384 × 7
   region zone       woreda      year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Oromia East Shewa Adama Town  2018 2018-01-01 confirmed    NA
 2 Oromia East Shewa Adama Town  2018 2018-02-01 confirmed    NA
 3 Oromia East Shewa Adama Town  2018 2018-03-01 confirmed    NA
 4 Oromia East Shewa Adama Town  2018 2018-04-01 confirmed    NA
 5 Oromia East Shewa Adama Town  2018 2018-05-01 confirmed    NA
 6 Oromia East Shewa Adama Town  2018 2018-06-01 confirmed    NA
 7 Oromia East Shewa Adama Town  2018 2018-07-01 confirmed    NA
 8 Oromia East Shewa Adama Town  2018 2018-08-01 confirmed    NA
 9 Oromia East Shewa Adama Town  2018 2018-09-01 confirmed    NA
10 Oromia East Shewa Adama Town  2018 2018-10-01 confirmed    NA
# ℹ 374 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question 4: Can you show all of the “presumed” data in the Somali region?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 5: Can you show all “confirmed” that have a count over 2000?</p>
</blockquote>
<p>Finally, the <code>!</code> operator in R used for NOT or opposite conditions. The most common use cases are for using NOT EQUAL (<code>!=</code>) or does NOT MATCH operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep all rows where region is NOT oromia</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, region <span class="sc">!=</span> <span class="st">"Addis Ababa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93,216 × 7
   region zone     woreda     year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Somali Shabelle Aba-Korow  2018 2018-01-01 confirmed    NA
 2 Somali Shabelle Aba-Korow  2018 2018-02-01 confirmed    NA
 3 Somali Shabelle Aba-Korow  2018 2018-03-01 confirmed    NA
 4 Somali Shabelle Aba-Korow  2018 2018-04-01 confirmed    NA
 5 Somali Shabelle Aba-Korow  2018 2018-05-01 confirmed    NA
 6 Somali Shabelle Aba-Korow  2018 2018-06-01 confirmed    NA
 7 Somali Shabelle Aba-Korow  2018 2018-07-01 confirmed    21
 8 Somali Shabelle Aba-Korow  2018 2018-08-01 confirmed    13
 9 Somali Shabelle Aba-Korow  2018 2018-09-01 confirmed    37
10 Somali Shabelle Aba-Korow  2018 2018-10-01 confirmed    20
# ℹ 93,206 more rows</code></pre>
</div>
</div>
<p>Note that for NOT EQUAL the <code>!</code> operator comes next to the <code>=</code> sign, but for the NOT MATCH condition the <code>!</code> comes before the condition state. In the second case you can read that as, “do the opposite of this condition”.</p>
<blockquote class="blockquote">
<p>Question 6a: Create a table for all confirmed malaria cases in Amhara and Harari regions in 2020.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 6b: Create a table for all presumed malaria cases NOT in Amhara and Harari regions in 2020.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 7a: Create a table for all presumed and confirmed cases that are over 500.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 7b: Create a table for all data that are NOT presumed and that are over 500.</p>
</blockquote>
<p>The types of conditional states that you can use depends on the type of column you want to base your <code>filter()</code>on. For example, <code>filter(case_data, count &gt; 1000)</code> makes sense since the <code>count</code> column contains <code>numeric</code> data. However, <code>filter(case_data, region &gt; 1000)</code> doesn’t make sense since the <code>region</code> column contains <code>character</code> data. The rule of thumb is that the value you use to set your condition should match the “type” of data in selected column.</p>
<p>In the next section, we see how to deal with a special case:</p>
</section>
<section id="working-with-dates-using-the-lubridate-package" class="level3">
<h3 class="anchored" data-anchor-id="working-with-dates-using-the-lubridate-package">Working with dates using the <code>*lubridate*</code> package</h3>
<p>In the “tidy” data approach to working with data each column is a specific type of data, each row is an observation, and each cell is an individual value which conveys a single piece of information. Our dataset matches this philosophy, except for the “period” values, which contain information on the year, month, and day of the observation.</p>
<p>We could create separate columns for the year, month, and day, but this may complicate our filtering. For instance, what happens if we want to filter for a study period that continues across over parts of adjacent months or year? Such a common task would require complex set of conditional statements to filter correctly.</p>
<p>The <code>*lubridate*</code> package provides a number of functions to make working with data much easier. This is not included in <code>*tidyverse*</code>, so we have to install and then load it into our session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(lubridate)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>ymd()</code> function allows us to create a <code>Date</code> class object based on the string input for YEAR-MONTH-DAY:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector of workshop days</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>workshop_days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2023-09-04"</span>, <span class="st">"2023-09-05"</span>, <span class="st">"2023-09-06"</span>, <span class="st">"2023-09-07"</span>,<span class="st">"2023-09-08"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a Date class</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>workshop_days <span class="ot">&lt;-</span> <span class="fu">ymd</span>(workshop_days)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date"</code></pre>
</div>
</div>
<p>Once you have a Date class object, <code>*lubridate*</code> provides many, many functions for working with date information. The primary functions we will use in this workshop are <code>year()</code> and <code>month()</code>, but there are many more in <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf">this <code>*lubridate*</code> cheatsheet</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2023 2023 2023 2023 2023</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9 9 9 9 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(workshop_days, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Sep Sep Sep Sep Sep
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
</div>
</div>
<p>These functions can be used in <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2020</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23,544 × 7
   region zone     woreda     year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Somali Shabelle Aba-Korow  2020 2020-01-01 confirmed    NA
 2 Somali Shabelle Aba-Korow  2020 2020-02-01 confirmed    NA
 3 Somali Shabelle Aba-Korow  2020 2020-03-01 confirmed    NA
 4 Somali Shabelle Aba-Korow  2020 2020-04-01 confirmed    NA
 5 Somali Shabelle Aba-Korow  2020 2020-05-01 confirmed    NA
 6 Somali Shabelle Aba-Korow  2020 2020-06-01 confirmed    NA
 7 Somali Shabelle Aba-Korow  2020 2020-07-01 confirmed    NA
 8 Somali Shabelle Aba-Korow  2020 2020-08-01 confirmed    NA
 9 Somali Shabelle Aba-Korow  2020 2020-09-01 confirmed    15
10 Somali Shabelle Aba-Korow  2020 2020-10-01 confirmed    NA
# ℹ 23,534 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, <span class="fu">between</span>(period, <span class="fu">ymd</span>(<span class="st">"2019-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2019-06-30"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,772 × 7
   region zone                 woreda     year period     data_type count
   &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Somali Shabelle             Aba-Korow  2019 2019-01-01 confirmed    NA
 2 Somali Shabelle             Aba-Korow  2019 2019-02-01 confirmed    NA
 3 Somali Shabelle             Aba-Korow  2019 2019-03-01 confirmed    NA
 4 Somali Shabelle             Aba-Korow  2019 2019-04-01 confirmed    NA
 5 Somali Shabelle             Aba-Korow  2019 2019-05-01 confirmed    NA
 6 Somali Shabelle             Aba-Korow  2019 2019-06-01 confirmed    NA
 7 Afar   Zone 2 (Kilbet Rasu) Aba 'Ala   2019 2019-01-01 confirmed    55
 8 Afar   Zone 2 (Kilbet Rasu) Aba 'Ala   2019 2019-02-01 confirmed    26
 9 Afar   Zone 2 (Kilbet Rasu) Aba 'Ala   2019 2019-03-01 confirmed     9
10 Afar   Zone 2 (Kilbet Rasu) Aba 'Ala   2019 2019-04-01 confirmed    25
# ℹ 11,762 more rows</code></pre>
</div>
</div>
<!-- > $\color{red}{\text{Question 4: What were the presumed total cases in Debati woreda each month during 2019?}}$ -->
<!-- > $\color{red}{\text{Question 5 (HARD): What were the monthly confirmed cases in Debati during Kiremt (~June-September)?}}$ -->
<!-- > \textcolor{red}{Question 4: What were the presumed total cases in Debati woreda each month during 2019?} -->
<!-- > \textcolor{red}{Question 5 (HARD): What were the monthly confirmed cases in Debati during Kiremt (~June-September)?} -->
<blockquote class="blockquote">
<p>Question 8: What were the reported total cases (presumed and confirmed) in Bambasi woreda each month during 2018?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 9: How many cases (presumed and confirmed) were reported in April 2020 in Gudetu Kondole woreda?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 10 (HARD): What were the monthly confirmed cases in Bambasi during the peak transmission season (~September-December) each year?</p>
</blockquote>
</section>
<section id="creating-new-columns-with-mutate" class="level3">
<h3 class="anchored" data-anchor-id="creating-new-columns-with-mutate">Creating new columns with <code>mutate()</code></h3>
<p>Another common task is creating new columns based on values in existing columns. The <code>*dplyr*</code> function for this action is <code>mutate()</code>.</p>
<p>Here is an example using the <code>*lubridate*</code> function from the section above to make a column for the month of observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(case_data, <span class="at">month =</span> <span class="fu">month</span>(period))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 94,176 × 8
   region zone     woreda     year period     data_type count month
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 Somali Shabelle Aba-Korow  2018 2018-01-01 confirmed    NA     1
 2 Somali Shabelle Aba-Korow  2018 2018-02-01 confirmed    NA     2
 3 Somali Shabelle Aba-Korow  2018 2018-03-01 confirmed    NA     3
 4 Somali Shabelle Aba-Korow  2018 2018-04-01 confirmed    NA     4
 5 Somali Shabelle Aba-Korow  2018 2018-05-01 confirmed    NA     5
 6 Somali Shabelle Aba-Korow  2018 2018-06-01 confirmed    NA     6
 7 Somali Shabelle Aba-Korow  2018 2018-07-01 confirmed    21     7
 8 Somali Shabelle Aba-Korow  2018 2018-08-01 confirmed    13     8
 9 Somali Shabelle Aba-Korow  2018 2018-09-01 confirmed    37     9
10 Somali Shabelle Aba-Korow  2018 2018-10-01 confirmed    20    10
# ℹ 94,166 more rows</code></pre>
</div>
</div>
<p>First, state the name for the new column, then <code>=</code> followed by the function for the new value. You can create multiple new columns in a single <code>mutate()</code> call, using a <code>,</code> to separate each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(case_data,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">month</span>(period),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_name =</span> <span class="fu">month</span>(period, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 94,176 × 9
   region zone     woreda   year period     data_type count month_num month_name
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;ord&gt;     
 1 Somali Shabelle Aba-Ko…  2018 2018-01-01 confirmed    NA         1 Jan       
 2 Somali Shabelle Aba-Ko…  2018 2018-02-01 confirmed    NA         2 Feb       
 3 Somali Shabelle Aba-Ko…  2018 2018-03-01 confirmed    NA         3 Mar       
 4 Somali Shabelle Aba-Ko…  2018 2018-04-01 confirmed    NA         4 Apr       
 5 Somali Shabelle Aba-Ko…  2018 2018-05-01 confirmed    NA         5 May       
 6 Somali Shabelle Aba-Ko…  2018 2018-06-01 confirmed    NA         6 Jun       
 7 Somali Shabelle Aba-Ko…  2018 2018-07-01 confirmed    21         7 Jul       
 8 Somali Shabelle Aba-Ko…  2018 2018-08-01 confirmed    13         8 Aug       
 9 Somali Shabelle Aba-Ko…  2018 2018-09-01 confirmed    37         9 Sep       
10 Somali Shabelle Aba-Ko…  2018 2018-10-01 confirmed    20        10 Oct       
# ℹ 94,166 more rows</code></pre>
</div>
</div>
<p>Remember that if you want to save any changes you will have to save the output into an object using the <code>&lt;-</code> assignment operator. Otherwise then will not be updated in your variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>case_data_dates <span class="ot">&lt;-</span> <span class="fu">mutate</span>(case_data,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">month</span>(period),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_name =</span> <span class="fu">month</span>(period, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In later sections we will see how to use <code>mutate()</code> to make calculations.</p>
<blockquote class="blockquote">
<p>Question 11: Can you add a new variable (column) to the dataset that gives the <strong>quarter</strong> of the year?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 12: Can you add a new variable (column) to the dataset that gives just the last 2 digits of the year? i.e.&nbsp;2021 becomes 21</p>
</blockquote>
</section>
</section>
<section id="use-pipes-to-combine-steps" class="level2">
<h2 class="anchored" data-anchor-id="use-pipes-to-combine-steps">Use Pipes to combine steps</h2>
<p>What if you want to select and filter at the same time? There are three ways to do this: use intermediate steps, nested functions, or pipes.</p>
<p>For intermediate steps, we need to create a new intermediate object for the output of our first function, which will then be used as an input for the second function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>case_data_oromia_confirmed <span class="ot">&lt;-</span> <span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span>, data_type <span class="sc">==</span> <span class="st">"confirmed"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>case_data_oromia_woreda_months <span class="ot">&lt;-</span> <span class="fu">select</span>(case_data_oromia_confirmed, woreda, period, count)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>case_data_oromia_woreda_months</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,032 × 3
   woreda period     count
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 Ababo  2018-01-01    NA
 2 Ababo  2018-02-01    NA
 3 Ababo  2018-03-01    NA
 4 Ababo  2018-04-01    NA
 5 Ababo  2018-05-01    NA
 6 Ababo  2018-06-01    NA
 7 Ababo  2018-07-01    16
 8 Ababo  2018-08-01    83
 9 Ababo  2018-09-01    35
10 Ababo  2018-10-01   167
# ℹ 16,022 more rows</code></pre>
</div>
</div>
<p>This approach is readable, but it can quickly clutter up your workspace and take up additional memory. And if you’re trying to use meaningful object names it can get tedious quickly.</p>
<p>You can also nest the functions (one function inside of the another).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>case_data_oromia_woreda_months <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(case_data, region <span class="sc">==</span> <span class="st">"Oromia"</span>, data_type <span class="sc">==</span> <span class="st">"confirmed"</span>), </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  woreda, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This doesn’t clutter the workshop or take up unnecessary memory, but it is difficult to read especially since R will interpret these steps from the inside out (first filter, then select).</p>
<p>The last option is to use pipes, a new addition to R. A pipe lets you take the output from one function and input it directly into the next function. By default, this will automatically go into the first argument of the new function. This is useful for stringing together multiple data cleaning steps while maintaining readability and keeping our environment clear. The <code>*tidyverse*</code> package includes a pipe function which looks like <code>%&gt;%</code>. In RStudio, the shortcut for this pipe is Ctrl + Shift + M if you have a PC or Cmd + Shift + M if you have a Mac. You can adjust this shortcut under Tools &gt;&gt; Modify Keyboard Shortcuts…</p>
<p>Here’s an example of using a pipe for combine the filter and select from the previous example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Oromia"</span>, data_type <span class="sc">==</span> <span class="st">"confirmed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(woreda, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,032 × 3
   woreda period     count
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 Ababo  2018-01-01    NA
 2 Ababo  2018-02-01    NA
 3 Ababo  2018-03-01    NA
 4 Ababo  2018-04-01    NA
 5 Ababo  2018-05-01    NA
 6 Ababo  2018-06-01    NA
 7 Ababo  2018-07-01    16
 8 Ababo  2018-08-01    83
 9 Ababo  2018-09-01    35
10 Ababo  2018-10-01   167
# ℹ 16,022 more rows</code></pre>
</div>
</div>
<p>In this code, we used a pipe to send <code>case_data</code> into a <code>filter()</code> function and keep the rows for confirmed cases in Oromia region, then used another pipe to send that output into a <code>select()</code> where we only kept the woreda, period, and count columns. We didn’t need to explicitly state the data object in the filter and select because data is always the first argument.</p>
<p>You may find it helpful to read the pipe like the word “then”. Take the case, then filter for Oromia region and confirmed cases, then select the woredas, periods, and counts. We can also save this into a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>oromia_confirmed_cases <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Oromia"</span>, data_type <span class="sc">==</span> <span class="st">"confirmed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(woreda, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<!-- > $\color{red}{\text{Question 6: Using pipes, create a table contain the presumed cases in January 2019 for each woreda in Somali region. The table should only have two columns (woreda and count)}}$ -->
<!-- > \textcolor{red}{Question 6: Using pipes, create a table contain the presumed cases in January 2019 for each woreda in Oromia region. The table should only have two columns (woreda and count)} -->
<blockquote class="blockquote">
<p>Question 13: Using pipes, create a table contain the confirmed cases in January 2019 for each woreda in Oromia region. The table should only have two columns (woreda and count)</p>
</blockquote>
<section id="grouping-and-summarizing-data" class="level3">
<h3 class="anchored" data-anchor-id="grouping-and-summarizing-data">Grouping and summarizing data</h3>
<p>Another common data manipulation task involves grouping data together and applying summary functions such as calculating means or totals. We can do some of these types of operations already. For instance, we can get the total number of presumed cases in Oromia region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>oromia_presumed <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>, region <span class="sc">==</span> <span class="st">"Oromia"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(oromia_presumed<span class="sc">$</span>count, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58132</code></pre>
</div>
</div>
<p>But what if we want to get summaries for each region at once? We could repeat the steps above, separating each region, calculating the totals, and then grouping these summaries back together. In programming this concept is often referred to as the <strong>split-apply-combine</strong> paradigm. The key <code>*dplyr*</code> functions for these tasks are <code>group_by()</code> and <code>summarize()</code> (you can also use the “proper” <code>summarise()</code> spelling as well).</p>
<p>First, <code>group_by()</code> takes in a column that contains categorical data, then use <code>summarize()</code> to calculate new summary statistics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_presumed =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   region           mean_presumed
   &lt;chr&gt;                    &lt;dbl&gt;
 1 Addis Ababa              13.2 
 2 Afar                     52.2 
 3 Amhara                   24.9 
 4 Benishangul Gumz         45.5 
 5 Dire Dawa                 6.54
 6 Gambela                  70.3 
 7 Harari                   12.2 
 8 Oromia                   16.9 
 9 SNNP                     29.6 
10 Somali                   54.8 
11 Tigray                   56.6 </code></pre>
</div>
</div>
<p>You can also group by more than one column, and output multiple columns within a single <code>summarize()</code> call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, woreda, year) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_presumed_per_month =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_presumed_per_month =</span> <span class="fu">sum</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,924 × 5
# Groups:   region, woreda [981]
   region      woreda         year mean_presumed_per_mo…¹ total_presumed_per_m…²
   &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
 1 Addis Ababa Addis Ketema   2018                  19.3                     212
 2 Addis Ababa Addis Ketema   2019                  66.6                     666
 3 Addis Ababa Addis Ketema   2020                  15.8                     158
 4 Addis Ababa Addis Ketema   2021                   2.67                     24
 5 Addis Ababa Akaki - Kalit  2018                  24.7                     272
 6 Addis Ababa Akaki - Kalit  2019                  66.3                     729
 7 Addis Ababa Akaki - Kalit  2020                  30.1                     331
 8 Addis Ababa Akaki - Kalit  2021                  27.8                     278
 9 Addis Ababa Arada          2018                   1.75                     14
10 Addis Ababa Arada          2019                   2.14                     15
# ℹ 3,914 more rows
# ℹ abbreviated names: ¹​mean_presumed_per_month, ²​total_presumed_per_month</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, woreda, year) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_presumed_per_month =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_presumed_per_month =</span> <span class="fu">sum</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,924 × 5
# Groups:   region, woreda [981]
   region      woreda         year mean_presumed_per_mo…¹ total_presumed_per_m…²
   &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
 1 Addis Ababa Addis Ketema   2018                  19.3                     212
 2 Addis Ababa Addis Ketema   2019                  66.6                     666
 3 Addis Ababa Addis Ketema   2020                  15.8                     158
 4 Addis Ababa Addis Ketema   2021                   2.67                     24
 5 Addis Ababa Akaki - Kalit  2018                  24.7                     272
 6 Addis Ababa Akaki - Kalit  2019                  66.3                     729
 7 Addis Ababa Akaki - Kalit  2020                  30.1                     331
 8 Addis Ababa Akaki - Kalit  2021                  27.8                     278
 9 Addis Ababa Arada          2018                   1.75                     14
10 Addis Ababa Arada          2019                   2.14                     15
# ℹ 3,914 more rows
# ℹ abbreviated names: ¹​mean_presumed_per_month, ²​total_presumed_per_month</code></pre>
</div>
</div>
<p>Sometimes it is useful to rearrange the result of our summarized dataset, in which case we can use the <code>arrange()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(woreda, period) <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_presumed_per_month =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(total_presumed_per_month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,760 × 3
# Groups:   woreda [980]
   woreda       period     total_presumed_per_month
   &lt;chr&gt;        &lt;date&gt;                        &lt;dbl&gt;
 1 Ada'a        2019-10-01                        1
 2 Ada'a        2019-11-01                        1
 3 Addi Arekay  2019-09-01                        1
 4 Addis Ketema 2019-09-01                        1
 5 Adhaki       2019-10-01                        1
 6 Adigrat Town 2019-01-01                        1
 7 Adola Town   2019-04-01                        1
 8 Adola Town   2019-08-01                        1
 9 Adola Town   2019-09-01                        1
10 Adola Town   2019-11-01                        1
# ℹ 11,750 more rows</code></pre>
</div>
</div>
<p>By default arranging with be in ascending order, you can use <code>desc()</code> to make the output descending.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"presumed"</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(woreda, period) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_presumed_per_month =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_presumed_per_month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,760 × 3
# Groups:   woreda [980]
   woreda           period     total_presumed_per_month
   &lt;chr&gt;            &lt;date&gt;                        &lt;dbl&gt;
 1 Goro Baqaqsa     2019-09-01                      838
 2 Tselemti         2019-11-01                      801
 3 Tsegede (Tigray) 2019-10-01                      628
 4 Tsegede (Tigray) 2019-11-01                      620
 5 Mirab Armacho    2019-10-01                      616
 6 Metema           2019-10-01                      606
 7 Tselemti         2019-12-01                      575
 8 Jawi             2019-10-01                      557
 9 Chwaka           2019-11-01                      551
10 Bambasi          2019-10-01                      550
# ℹ 11,750 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question 14: What were the total number of confirmed cases in each region in 2019?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 15: What were the total number of cases (presumed and confirmed) in each month for all regions for each year?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 16 (HARD): What were the total number of cases (presumed and confirmed) in the peak (September - December) and the low (January - April) transmission seasons for each woreda in Somali region during 2020?</p>
</blockquote>
</section>
</section>
<section id="reshaping-data-with-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-data-with-tidyr">Reshaping data with <code>*tidyr*</code></h2>
<p>So far we have covered a bunch of <code>*dplyr*</code> functions for manipulating data, most of which have changed the number of rows and/or columns in our dataframe. However, even though the columns, rows, and values have changed none of these have changed the “structure” of the dataframe. At the end of each function or piped function, the output always followed the conditions we discussed early:</p>
<ol type="1">
<li>Each column should be a single variable with one data type.</li>
<li>Each row should be a single observation.</li>
<li>Each cell should be a single value contains <strong>one</strong> piece of information.</li>
</ol>
<p>This is commonly referred to as “long” format data, and often this means that there are relatively more rows than columns. Typically it is best to work in “long” format data, especially in R, however there are instances when we may want to change the “shape” of our data into the “wide” format. In Microsoft Excel this would be called creating a Pivot Table.</p>
<p>The <code>*tidyr*</code> package provides functions for reshaping data, including creating “wide” format pivot tables. To illustrate, lets take a look at records for a single woreda at a single timepoint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(woreda <span class="sc">==</span> <span class="st">"Awabel"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  region zone       woreda  year period     data_type count
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 Amhara East Gojam Awabel  2020 2020-01-01 confirmed    55
2 Amhara East Gojam Awabel  2020 2020-01-01 presumed      2</code></pre>
</div>
</div>
<p>The resulting table has six rows, because there are six different types of records included. But what if we wanted to create a table where there is a separate column for each type of record? The <code>pivot_wider()</code> function will allow us to create this kind of “wide” format table. This function requires us to state the column which our column names will come from (<code>names_from</code>), and which column the values in the new columns will come from (<code>values_from</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(woreda <span class="sc">==</span> <span class="st">"Awabel"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> data_type, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  region zone       woreda  year period     confirmed presumed
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt;
1 Amhara East Gojam Awabel  2020 2020-01-01        55        2</code></pre>
</div>
</div>
<p>The resulting output just has one row, but new columns for each of the types of records. This “wide” format is often useful for creating summary tables.</p>
<p>The opposite function is called <code>pivot_longer()</code>, which will take in a “wide” format table and output a “long” format table. For <code>pivot_longer()</code> we need to state the column name for the “key” which provides the label, the column names for the values, and which columns we want to pivot on. Here is how we can convert the above example from “wide” format to “long” format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(woreda <span class="sc">==</span> <span class="st">"Awabel"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> data_type, <span class="at">values_from =</span> count)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"data_type"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(confirmed, presumed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  region zone       woreda  year period     data_type count
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 Amhara East Gojam Awabel  2020 2020-01-01 confirmed    55
2 Amhara East Gojam Awabel  2020 2020-01-01 presumed      2</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question 17: Create a table that contains the total number of confirmed cases each year for each region, then pivot wider to make it so the rows are the year and there is a column for each region.</p>
</blockquote>
<p>Think of this as a multi-step process<br>
1. Filter for confirmed cases<br>
2. Work out which columns you are grouping by (i.e.&nbsp;what are we grouping over….think geography/time?)<br>
3. Look at the output so far - what do we now want to sum over for our table?<br>
4. Now we need to pivot wider - we want to make new columns - where do those names to come from (names_from)?, where will we find the values to populate the new cells (values_from)?</p>
<blockquote class="blockquote">
<p>Question 17b: Can you make this table longer again, where we now have 3 columns - year, region and count</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 18: Create a table that contains the total number of confirmed cases for each woreda and each year in Somali region, now pivot wider to make each woreda its own column where year is now the row - start by writing out the steps 1 by 1 as above</p>
</blockquote>
</section>
<section id="final-exercises" class="level2">
<h2 class="anchored" data-anchor-id="final-exercises">Final exercises</h2>
<blockquote class="blockquote">
<ol type="1">
<li>For each region, calculate the total number of cases confirmed by RDT each year and present as a wide dataframe, where each column is a year and each row is a region and finally, order the dataframe such that the region with the most cases in 2020 is at the top</li>
</ol>
</blockquote>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>For each woreda in Oromia region, calculate the proportion of total cases in 2020 that were confirmed (confirmed cases / confirmed cases + presumed)</li>
</ol>
</blockquote>
<p>Tips:</p>
<ol type="1">
<li>Start by filtering your data - what geographical region, year, and data types do we need?<br>
</li>
<li>Now we need to pivot wider - how can we now have data_type as our column names?<br>
</li>
<li>Now we need to group_by - what are we grouping by?<br>
</li>
<li>Almost there!! Now we need to sum up some columns - how can we do this?<br>
</li>
<li>Now to calculate the proportion - let’s use the mutate function<br>
</li>
<li>Now let’s use the ‘select’ function to retrieve the columns we want</li>
</ol>
</section>
<section id="function-cheatsheet" class="level2">
<h2 class="anchored" data-anchor-id="function-cheatsheet">Function cheatsheet</h2>
<ul>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">Main cheat sheet page</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf"><code>*dplyr*</code> cheat sheet link</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf"><code>lubridate</code> cheat sheet</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf"><code>tidyr</code> cheat sheet</a></li>
</ul>
<p><code>*dplyr*</code> functions</p>
<ul>
<li><code>select()</code>: subset columns</li>
<li><code>filter()</code>: subset rows on condition</li>
<li><code>mutate()</code>: create new columns</li>
<li><code>group_by()</code>: group data by one or more column</li>
<li><code>summarise()</code>: create summaries from dataframe (works within groups)</li>
<li><code>arrange()</code>: reorder dataframe based on ascending order (use <code>desc()</code> to invert)</li>
</ul>
<p><code>*tidyr*</code> functions</p>
<ul>
<li><code>pivot_wider()</code>: go from “long” to “wide” format</li>
<li><code>pivot_longer()</code>: go from “wide” to “long” format</li>
</ul>
<p><code>*lubridate*</code> functions</p>
<ul>
<li><code>ymd()</code>: convert class to date object based on “YYYY-MM-DD”</li>
<li><code>year()</code>: return the year from a date input</li>
<li><code>month()</code>: return the month from a date input</li>
<li><code>quarter()</code>: return the year quarter (1,2,3,4) from a date input</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./pipes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Chaining multiple steps using pipes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./joins.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">Joining data in tidyverse</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>