<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EpidemiaR Introductiory Materials - 5&nbsp; Data manipulation with *dplyr* and *tidyr*</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./joins.html" rel="next">
<link href="./pipes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dpylr-tidyr-intro.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data manipulation with `*dplyr*` and `*tidyr*`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EpidemiaR Introductiory Materials</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-r-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R and Rstudio and basic functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./if-statements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using <code>if</code> statements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./more-base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">More base R functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chaining multiple steps using pipes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dpylr-tidyr-intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data manipulation with <code>*dplyr*</code> and <code>*tidyr*</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joining data in tidyverse</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-manipulation-with-dplyr-and-tidyr" id="toc-data-manipulation-with-dplyr-and-tidyr" class="nav-link active" data-scroll-target="#data-manipulation-with-dplyr-and-tidyr"><span class="header-section-number">6</span> <strong>Data Manipulation with dplyr and tidyr</strong></a>
  <ul class="collapse">
  <li><a href="#the-power-of-packages" id="toc-the-power-of-packages" class="nav-link" data-scroll-target="#the-power-of-packages"><span class="header-section-number">6.1</span> <strong>The power of packages</strong></a>
  <ul class="collapse">
  <li><a href="#installing-and-loading-packages" id="toc-installing-and-loading-packages" class="nav-link" data-scroll-target="#installing-and-loading-packages"><span class="header-section-number">6.1.1</span> <strong>Installing and loading packages</strong></a></li>
  </ul></li>
  <li><a href="#reading-data-into-r" id="toc-reading-data-into-r" class="nav-link" data-scroll-target="#reading-data-into-r"><span class="header-section-number">6.2</span> <strong>Reading data into R</strong></a>
  <ul class="collapse">
  <li><a href="#inspecting-data" id="toc-inspecting-data" class="nav-link" data-scroll-target="#inspecting-data"><span class="header-section-number">6.2.1</span> <strong>Inspecting data</strong></a></li>
  </ul></li>
  <li><a href="#data-manipulation-using-tidyverse" id="toc-data-manipulation-using-tidyverse" class="nav-link" data-scroll-target="#data-manipulation-using-tidyverse"><span class="header-section-number">6.3</span> <strong>Data manipulation using <code>*tidyverse*</code></strong></a>
  <ul class="collapse">
  <li><a href="#selecting-columns-and-filtering-rows" id="toc-selecting-columns-and-filtering-rows" class="nav-link" data-scroll-target="#selecting-columns-and-filtering-rows"><span class="header-section-number">6.3.1</span> <strong>Selecting columns and filtering rows</strong></a></li>
  <li><a href="#working-with-dates-using-the-lubridate-package" id="toc-working-with-dates-using-the-lubridate-package" class="nav-link" data-scroll-target="#working-with-dates-using-the-lubridate-package"><span class="header-section-number">6.3.2</span> <strong>Working with dates using the <code>*lubridate*</code> package</strong></a></li>
  <li><a href="#creating-new-columns-with-mutate" id="toc-creating-new-columns-with-mutate" class="nav-link" data-scroll-target="#creating-new-columns-with-mutate"><span class="header-section-number">6.3.3</span> <strong>Creating new columns with <code>mutate()</code></strong></a></li>
  </ul></li>
  <li><a href="#use-pipes-to-combine-steps" id="toc-use-pipes-to-combine-steps" class="nav-link" data-scroll-target="#use-pipes-to-combine-steps"><span class="header-section-number">6.4</span> <strong>Use Pipes to combine steps</strong></a>
  <ul class="collapse">
  <li><a href="#grouping-and-summarizing-data" id="toc-grouping-and-summarizing-data" class="nav-link" data-scroll-target="#grouping-and-summarizing-data"><span class="header-section-number">6.4.1</span> <strong>Grouping and summarizing data</strong></a></li>
  </ul></li>
  <li><a href="#reshaping-data-with-tidyr" id="toc-reshaping-data-with-tidyr" class="nav-link" data-scroll-target="#reshaping-data-with-tidyr"><span class="header-section-number">6.5</span> <strong>Reshaping data with <code>*tidyr*</code></strong></a></li>
  <li><a href="#final-exercises" id="toc-final-exercises" class="nav-link" data-scroll-target="#final-exercises"><span class="header-section-number">6.6</span> <strong>Final Exercises</strong></a></li>
  <li><a href="#function-cheatsheet" id="toc-function-cheatsheet" class="nav-link" data-scroll-target="#function-cheatsheet"><span class="header-section-number">6.7</span> <strong>Function cheatsheet</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data manipulation with <code>*dplyr*</code> and <code>*tidyr*</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data-manipulation-with-dplyr-and-tidyr" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> <strong>Data Manipulation with dplyr and tidyr</strong></h1>
<section id="the-power-of-packages" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="the-power-of-packages"><span class="header-section-number">6.1</span> <strong>The power of packages</strong></h2>
<p>One of the great things about using R are the thousands of available packages, which provide additional functions for many analytical tasks, such as data cleaning, statistical modelling, mapping, and much more. R packages are open-source, which means that they are free to use and maintained by the R community.</p>
<section id="installing-and-loading-packages" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="installing-and-loading-packages"><span class="header-section-number">6.1.1</span> <strong>Installing and loading packages</strong></h3>
<p>Throughout the rest of this training we will use a set of R packages manipulating data and creating plots and maps. As we covered in Chapter 1, we first need to install the package on our computer using the <code>install.packages()</code> function. This only needs to be done one time (you probably already did this earlier).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the package has been installed, we can load it into our current R session using the <code>library()</code> function. Unlike installing, you will need to load the library each time you want to use it. This is because some libraries may have functions with the same names as other libraries or as our variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the next series of exercises, we will be using a group of packages which have been designed to work together to do common data science tasks. This <a href="https://www.tidyverse.org/">group of packages is called the “Tidyverse”</a>, because it is designed to work within the <a href="https://r4ds.had.co.nz/tidy-data.html#tidy-data-1">“tidy” data philosophy</a>:</p>
<!-- [![](https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png "Tidy data")](https://r4ds.had.co.nz/tidy-data.html#tidy-data) -->
<p><img src="hs_images/02_tidy-1.png" class="img-fluid"></p>
<p>Some important qualities of this philosophy is that our data should have the following format:</p>
<ol type="1">
<li>Each column should be a single variable with one data type.</li>
<li>Each row should be a single observation.</li>
<li>Each cell should be a single value contains <strong>one</strong> piece of information.</li>
</ol>
<p>We can install all of these packages at once using <code>install.package("tidyverse")</code>. Remember that we only install the package once, so it is actually better to type this directly into the console instead of in our R script since it does not need to be repeated. Also be aware that this may take some time especially if internet quality is poor. After the package has finished installing it is ready to be loaded into our R session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="reading-data-into-r" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="reading-data-into-r"><span class="header-section-number">6.2</span> <strong>Reading data into R</strong></h2>
<p>Once the <strong><code>tidyverse</code></strong> package is loaded into our session we will have access to all of the functions in each of the Tidyverse packages. This includes packages for loading, manipulating, and plotting data. The function we will use is <code>read_csv()</code> to read in the district-level data we worked with previously. Note that this is <a href="https://r4ds.had.co.nz/data-import.html#compared-to-base-r">similar but slightly different to the read.csv()</a> function we used in our previous exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>scram_num <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">offset =</span> <span class="fl">0.5</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(<span class="dv">1</span>, x<span class="sc">*</span>offset, x<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>offset)))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>case_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/district-cases-long.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">scram_num</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the same dataset we used in Chapter 1 (values scrambled to prevent unauthorized access to confidential data), only this time we called the object <code>case_data</code> instead of <code>dat</code>. It’s good practice to name your objects something short and meaningful, so that it’s easy to type and remember (this is especially useful when you have multiple data objects).</p>
<p>Also, in this file the data are organized in “long” format, whereas the file used in Chapter 1 was in “wide” format. We will discuss the difference between “long” and “wide” formatted data in this chapter, as well as how to change the shape of our data.</p>
<section id="inspecting-data" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="inspecting-data"><span class="header-section-number">6.2.1</span> <strong>Inspecting data</strong></h3>
<p>Like in the previous exercise, we can use the <code>head()</code> and <code>summary()</code> functions to view aspects of the dataframe. We can also use the <code>view()</code> function to open the entire file in the R Studio Viewer, however view large files (millions of rows) can cause R Studio to crash. We can also install additional packages, such as <strong><code>skimr</code></strong> to get an even more detailed summary (run <code>install.package("skimr")</code> in your console).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(case_data)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(case_data)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(case_data)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Using skimr package, remember to install first!</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(case_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- \textcolor{red}{Question 1: How many rows and columns are in case_data?} -->
<!-- \textcolor{red}{Question 2: What "type" of data are each column (character, vector, etc.)?} -->
<blockquote class="blockquote">
<p>Question 1: How many rows and columns are in case_data?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 2: What “type” of data are each column (character, vector, etc.)?</p>
</blockquote>
</section>
</section>
<section id="data-manipulation-using-tidyverse" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="data-manipulation-using-tidyverse"><span class="header-section-number">6.3</span> <strong>Data manipulation using <code>*tidyverse*</code></strong></h2>
<p>In Chapter 1 we learned some built-in functions, or “base” functions, for simple data manipulations such as selecting a specific column or filter for only rows that match some criteria. In this lesson we will learn the <code>*tidyverse*</code> approach to these and additional common data manipulation tasks, using two packages called <code>*dplyr*</code> and <code>*tidyr*</code>. The <code>*dplyr*</code> package provides functions for the most common data manipulations jobs, and the <code>*tidyr*</code>package provides functions for reshaping or pivoting dataframes (similar to pivot tables in Microsoft Excel).</p>
<section id="selecting-columns-and-filtering-rows" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="selecting-columns-and-filtering-rows"><span class="header-section-number">6.3.1</span> <strong>Selecting columns and filtering rows</strong></h3>
<p>To select a specific column from a dataframe, use the <code>select()</code> functions. The first argument will always be the dataframe object that you’re working with, followed by the name(s) of the column or columns you want to select.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select just one column (province)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, province)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select multiple columns</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, district, data_type, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To select all the columns <strong>except</strong> certain ones, you can use a <code>-</code> in front of the column name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all but one column</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, <span class="sc">-</span>province)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing multiple columns</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(case_data, <span class="sc">-</span>period, <span class="sc">-</span>province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To choose specific rows based on some criteria, use <code>filter()</code>. Again, the first argument will be the dataframe, then the following argument will be the condition that we want use to subset the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Eastern"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,294 × 5
# Rowwise: 
   period     province district   data_type count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;
 1 2018-01-01 Eastern  Chadiza    Clinical     89
 2 2018-01-01 Eastern  Chadiza    Confirmed  3926
 3 2018-01-01 Eastern  Chadiza    Tested     8261
 4 2018-01-01 Eastern  Chasefu    Clinical    357
 5 2018-01-01 Eastern  Chasefu    Confirmed  2599
 6 2018-01-01 Eastern  Chasefu    Tested     9021
 7 2018-01-01 Eastern  Chipangali Confirmed  6330
 8 2018-01-01 Eastern  Chipangali Tested    21612
 9 2018-01-01 Eastern  Chipata    Clinical    417
10 2018-01-01 Eastern  Chipata    Confirmed  4079
# ℹ 2,284 more rows</code></pre>
</div>
</div>
<p>Notice here that just like in Chapter 1 use have to use a <code>==</code> sign for setting a condition. You read this as saying, “choose the rows in <code>case_data</code> where province is equal to”Eastern”. Also notice that the number of rows in the object has gone down from 18172 to 2294.</p>
<p>We can filter on multiple conditions at once using multiple arguments, using a <code>,</code> to state separate conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Eastern"</span>, data_type <span class="sc">==</span> <span class="st">"Clinical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 379 × 5
# Rowwise: 
   period     province district   data_type count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;
 1 2018-01-01 Eastern  Chadiza    Clinical     89
 2 2018-01-01 Eastern  Chasefu    Clinical    357
 3 2018-01-01 Eastern  Chipata    Clinical    417
 4 2018-01-01 Eastern  Kasenengwa Clinical    331
 5 2018-01-01 Eastern  Katete     Clinical     28
 6 2018-01-01 Eastern  Lumezi     Clinical     19
 7 2018-01-01 Eastern  Lundazi    Clinical     38
 8 2018-01-01 Eastern  Lusangazi  Clinical     58
 9 2018-01-01 Eastern  Petauke    Clinical     20
10 2018-01-01 Eastern  Sinda      Clinical      1
# ℹ 369 more rows</code></pre>
</div>
</div>
<p>By default, each of the conditions in <code>filter()</code> must be TRUE to remain in the subset, however there are special operators that allow for more complex conditional operations. The most common are the AND (<code>&amp;</code>) and OR (<code>|</code>) operators. Here are some examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Province is Easter AND data type is Clinical </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Eastern"</span> <span class="sc">&amp;</span> data_type <span class="sc">==</span> <span class="st">"Clinical"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Province is Eastern OR data type is Clinical </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Eastern"</span> <span class="sc">|</span> data_type <span class="sc">==</span> <span class="st">"Clinical"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Province is Central OR Eastern, AND count is over 1,000</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Central"</span> <span class="sc">|</span> province <span class="sc">==</span> <span class="st">"Eastern"</span>, count <span class="sc">&gt;</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- > $\color{red}{\text{Question 3: Why did we not use & in the third example?}}$ -->
<blockquote class="blockquote">
<p>Question 3: Why did we not use &amp; in the third example?</p>
</blockquote>
<p>Another useful operator is the MATCH operator (<code>%in%</code>), which will return TRUE if a value matches any value in a list of possible options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep rows where data type could be Clinical, Confirmed, or Tested</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Clinical"</span>, <span class="st">"Confirmed"</span>, <span class="st">"Tested"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,062 × 5
# Rowwise: 
   period     province district     data_type count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt;
 1 2018-01-01 Central  Chibombo     Clinical     26
 2 2018-01-01 Central  Chibombo     Confirmed  1897
 3 2018-01-01 Central  Chibombo     Tested     8215
 4 2018-01-01 Central  Chisamba     Confirmed  2192
 5 2018-01-01 Central  Chisamba     Tested     7772
 6 2018-01-01 Central  Chitambo     Clinical     33
 7 2018-01-01 Central  Chitambo     Confirmed  6011
 8 2018-01-01 Central  Chitambo     Tested     3993
 9 2018-01-01 Central  Itezhi-tezhi Confirmed   890
10 2018-01-01 Central  Itezhi-tezhi Tested     5007
# ℹ 13,052 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep rows from a group of selected districts</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>study_districts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Chadiza"</span>, <span class="st">"Chipata"</span>, <span class="st">"Katete"</span>, <span class="st">"Lumezi"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, district <span class="sc">%in%</span> study_districts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 649 × 5
# Rowwise: 
   period     province district data_type count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
 1 2018-01-01 Eastern  Chadiza  Clinical     89
 2 2018-01-01 Eastern  Chadiza  Confirmed  3926
 3 2018-01-01 Eastern  Chadiza  Tested     8261
 4 2018-01-01 Eastern  Chipata  Clinical    417
 5 2018-01-01 Eastern  Chipata  Confirmed  4079
 6 2018-01-01 Eastern  Chipata  Tested    20550
 7 2018-01-01 Eastern  Katete   Clinical     28
 8 2018-01-01 Eastern  Katete   Confirmed  3124
 9 2018-01-01 Eastern  Katete   Tested    18207
10 2018-01-01 Eastern  Lumezi   Clinical     19
# ℹ 639 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question 4: Can you show all of the “Tested” data in Western Province?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 5: Can you show all “Confirmed” that have a count over 2000?</p>
</blockquote>
<p>Finally, the <code>!</code> operator in R used for NOT or opposite conditions. The most common use cases are for using NOT EQUAL (<code>!=</code>) or does NOT MATCH operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep all rows where province is NOT Lusaka</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, province <span class="sc">!=</span> <span class="st">"Lusaka"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,993 × 5
# Rowwise: 
   period     province district     data_type             count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt;
 1 2018-01-01 Central  Chibombo     Clinical                 26
 2 2018-01-01 Central  Chibombo     Confirmed              1897
 3 2018-01-01 Central  Chibombo     Tested                 8215
 4 2018-01-01 Central  Chisamba     Confirmed              2192
 5 2018-01-01 Central  Chisamba     Tested                 7772
 6 2018-01-01 Central  Chitambo     Clinical                 33
 7 2018-01-01 Central  Chitambo     Confirmed              6011
 8 2018-01-01 Central  Chitambo     Tested                 3993
 9 2018-01-01 Central  Itezhi-tezhi Confirmed               890
10 2018-01-01 Central  Itezhi-tezhi Confirmed_Passive_CHW   897
# ℹ 16,983 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep rows where data type does NOT match Clinical, Confirmed, or Tested</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, <span class="sc">!</span>data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Clinical"</span>, <span class="st">"Confirmed"</span>, <span class="st">"Tested"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,110 × 5
# Rowwise: 
   period     province district     data_type             count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt;
 1 2018-01-01 Central  Itezhi-tezhi Confirmed_Passive_CHW   897
 2 2018-01-01 Central  Itezhi-tezhi Tested_Passive_CHW     2708
 3 2018-01-01 Central  Mumbwa       Confirmed_Passive_CHW   861
 4 2018-01-01 Central  Mumbwa       Tested_Passive_CHW     3173
 5 2018-01-01 Central  Shibuyunji   Confirmed_Passive_CHW     6
 6 2018-01-01 Central  Shibuyunji   Tested_Passive_CHW       94
 7 2018-01-01 Eastern  Petauke      Confirmed_Passive_CHW     0
 8 2018-01-01 Eastern  Petauke      Tested_Passive_CHW        0
 9 2018-01-01 Lusaka   Chirundu     Confirmed_Passive_CHW    55
10 2018-01-01 Lusaka   Chirundu     Tested_Passive_CHW      406
# ℹ 5,100 more rows</code></pre>
</div>
</div>
<p>Note that for NOT EQUAL the <code>!</code> operator comes right next to the <code>=</code> sign, but for the NOT MATCH condition the <code>!</code> comes before the condition state. In the second case you can read that as, “do the opposite of this condition”.</p>
<blockquote class="blockquote">
<p>Question 6a: Create a table for all malaria tests (health facility and CHW) in Western and Southern Province in 2020.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 6b: Create a table for all malaria tests (health facility and CHW) NOT in Western and Southern Province in 2020.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 7a: Create a table for all clinical and confirmed cases that are over 500.</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 7b: Create a table for all data that are NOT clinical and confirmed cases that are over 500.</p>
</blockquote>
<p>The types of conditional states that you can use depends on the type of column you want to base your <code>filter()</code>on. For example, <code>filter(case_data, count &gt; 1000)</code> makes sense since the <code>count</code> column contains <code>numeric</code> data. However, <code>filter(case_data, province &gt; 1000)</code> doesn’t make sense since the <code>province</code> column contains <code>character</code> data. The rule of thumb is that the value you use to set your condition should match the “type” of data in selected column.</p>
<p>In the next section, we see how to deal with a special case:</p>
</section>
<section id="working-with-dates-using-the-lubridate-package" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="working-with-dates-using-the-lubridate-package"><span class="header-section-number">6.3.2</span> <strong>Working with dates using the <code>*lubridate*</code> package</strong></h3>
<p>In the “tidy” data approach to working with data each column is a specific type of data, each row is an observation, and each cell is an individual value which conveys a single piece of information. Our dataset matches this philosophy, except for the “period” values, which contain information on the year, month, and day of the observation.</p>
<p>We could create separate columns for the year, month, and day, but this may complicate our filtering. For instance, what happens if we want to filter for a study period that continues across over parts of adjacent months or year? Such a common task would require complex set of conditional statements to filter correctly.</p>
<p>The <code>*lubridate*</code> package provides a number of functions to make working with data much easier. This is not included in <code>*tidyverse*</code>, so we have to install and then load it into our session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(lubridate)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>ymd()</code> function allows us to create a <code>Date</code> class object based on the string input for YEAR-MONTH-DAY:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector of workshop days</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>workshop_days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021-11-15"</span>, <span class="st">"2021-11-16"</span>, <span class="st">"2021-11-17"</span>, <span class="st">"2021-11-18"</span>,<span class="st">"2021-11-19"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a Date class</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>workshop_days <span class="ot">&lt;-</span> <span class="fu">ymd</span>(workshop_days)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date"</code></pre>
</div>
</div>
<p>Once you have a Date class object, <code>*lubridate*</code> provides many, many functions for working with date information. The primary functions we will use in this workshop are <code>year()</code> and <code>month()</code>, but there are many more in <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf">this <code>*lubridate*</code> cheatsheet</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2021 2021 2021 2021 2021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(workshop_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 11 11 11 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(workshop_days, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Nov Nov Nov Nov Nov
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
</div>
</div>
<p>These functions can be used in <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2020</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,232 × 5
# Rowwise: 
   period     province district     data_type             count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt;
 1 2020-01-01 Central  Chibombo     Clinical                 51
 2 2020-01-01 Central  Chibombo     Confirmed              9473
 3 2020-01-01 Central  Chibombo     Tested                17192
 4 2020-01-01 Central  Chisamba     Confirmed              2885
 5 2020-01-01 Central  Chisamba     Tested                 5499
 6 2020-01-01 Central  Chitambo     Clinical               1895
 7 2020-01-01 Central  Chitambo     Confirmed              9929
 8 2020-01-01 Central  Chitambo     Tested                12642
 9 2020-01-01 Central  Itezhi-tezhi Confirmed              1406
10 2020-01-01 Central  Itezhi-tezhi Confirmed_Passive_CHW  1184
# ℹ 5,222 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(case_data, <span class="fu">between</span>(period, <span class="fu">ymd</span>(<span class="st">"2019-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2019-06-30"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,394 × 5
# Rowwise: 
   period     province district     data_type count
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt;
 1 2019-01-01 Central  Chibombo     Clinical    347
 2 2019-01-01 Central  Chibombo     Confirmed  3706
 3 2019-01-01 Central  Chibombo     Tested     8116
 4 2019-01-01 Central  Chisamba     Confirmed  2304
 5 2019-01-01 Central  Chisamba     Tested     6975
 6 2019-01-01 Central  Chitambo     Clinical      2
 7 2019-01-01 Central  Chitambo     Confirmed  7328
 8 2019-01-01 Central  Chitambo     Tested     8320
 9 2019-01-01 Central  Itezhi-tezhi Clinical      6
10 2019-01-01 Central  Itezhi-tezhi Confirmed   833
# ℹ 2,384 more rows</code></pre>
</div>
</div>
<!-- > $\color{red}{\text{Question 4: What where the reported total tests in Chadiza district each month during 2018?}}$ -->
<!-- > $\color{red}{\text{Question 5 (HARD): What the monthly clinical cases in Chadiza during the rainy season (November to March?}}$ -->
<!-- > \textcolor{red}{Question 4: What where the reported total tests in Chadiza district each month during 2018?} -->
<!-- > \textcolor{red}{Question 5 (HARD): What the monthly clinical cases in Chadiza during the rainy season (November to March?} -->
<blockquote class="blockquote">
<p>Question 8: What were the reported total tests (HF and CHW) in Chadiza district each month during 2018?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 9: How many tests (HF and CHW) were conducted in April 2020 in Nchelenge district?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 10 (HARD): What were the monthly confirmed cases in Chadiza during the peak transmission season (December to May) each year?</p>
</blockquote>
</section>
<section id="creating-new-columns-with-mutate" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="creating-new-columns-with-mutate"><span class="header-section-number">6.3.3</span> <strong>Creating new columns with <code>mutate()</code></strong></h3>
<p>Another common task is creating new columns based on values in existing columns. The <code>*dplyr*</code> function for this action is <code>mutate()</code>.</p>
<p>Here is an example using the <code>*lubridate*</code> function from the section above to make a column for the year of observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(case_data, <span class="at">year =</span> <span class="fu">year</span>(period))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,172 × 6
# Rowwise: 
   period     province district     data_type             count  year
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;
 1 2018-01-01 Central  Chibombo     Clinical                 26  2018
 2 2018-01-01 Central  Chibombo     Confirmed              1897  2018
 3 2018-01-01 Central  Chibombo     Tested                 8215  2018
 4 2018-01-01 Central  Chisamba     Confirmed              2192  2018
 5 2018-01-01 Central  Chisamba     Tested                 7772  2018
 6 2018-01-01 Central  Chitambo     Clinical                 33  2018
 7 2018-01-01 Central  Chitambo     Confirmed              6011  2018
 8 2018-01-01 Central  Chitambo     Tested                 3993  2018
 9 2018-01-01 Central  Itezhi-tezhi Confirmed               890  2018
10 2018-01-01 Central  Itezhi-tezhi Confirmed_Passive_CHW   897  2018
# ℹ 18,162 more rows</code></pre>
</div>
</div>
<p>First, state the name for the new column, then <code>=</code> followed by the function for the new value. You can create multiple new columns in a single <code>mutate()</code> call, using a <code>,</code> to separate each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(case_data,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(period), </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">month</span>(period),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_name =</span> <span class="fu">month</span>(period, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,172 × 8
# Rowwise: 
   period     province district     data_type   count  year month_num month_name
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;ord&gt;     
 1 2018-01-01 Central  Chibombo     Clinical       26  2018         1 Jan       
 2 2018-01-01 Central  Chibombo     Confirmed    1897  2018         1 Jan       
 3 2018-01-01 Central  Chibombo     Tested       8215  2018         1 Jan       
 4 2018-01-01 Central  Chisamba     Confirmed    2192  2018         1 Jan       
 5 2018-01-01 Central  Chisamba     Tested       7772  2018         1 Jan       
 6 2018-01-01 Central  Chitambo     Clinical       33  2018         1 Jan       
 7 2018-01-01 Central  Chitambo     Confirmed    6011  2018         1 Jan       
 8 2018-01-01 Central  Chitambo     Tested       3993  2018         1 Jan       
 9 2018-01-01 Central  Itezhi-tezhi Confirmed     890  2018         1 Jan       
10 2018-01-01 Central  Itezhi-tezhi Confirmed_…   897  2018         1 Jan       
# ℹ 18,162 more rows</code></pre>
</div>
</div>
<p>Remember that if you want to save any changes you will have to save the output into an object using the <code>&lt;-</code> assignment operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>case_data_dates <span class="ot">&lt;-</span> <span class="fu">mutate</span>(case_data,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(period), </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">month</span>(period),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_name =</span> <span class="fu">month</span>(period, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In later sections we will see how to use <code>mutate()</code> to make calculations.</p>
<blockquote class="blockquote">
<p>Question 11: Can you add a new variable (column) to the dataset that gives the <strong>quarter</strong> of the year?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 12: Can you add a new variable (column) to the dataset that gives just the last 2 digits of the year? i.e.&nbsp;2021 becomes 21</p>
</blockquote>
</section>
</section>
<section id="use-pipes-to-combine-steps" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="use-pipes-to-combine-steps"><span class="header-section-number">6.4</span> <strong>Use Pipes to combine steps</strong></h2>
<p>What if you want to select and filter at the same time? There are three ways to do this: use intermediate steps, nested functions, or pipes.</p>
<p>For intermediate steps, we need to create a new intermediate object for the output of our first function, which will then be used as an input for the second function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>case_data_lusaka_confirmed <span class="ot">&lt;-</span> <span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Lusaka"</span>, data_type <span class="sc">==</span> <span class="st">"Confirmed"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>case_data_lusaka_district_months <span class="ot">&lt;-</span> <span class="fu">select</span>(case_data_lusaka_confirmed, district, period, count)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>case_data_lusaka_district_months</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 301 × 3
# Rowwise: 
   district period     count
   &lt;chr&gt;    &lt;date&gt;     &lt;dbl&gt;
 1 Chilanga 2018-01-01   151
 2 Chirundu 2018-01-01   198
 3 Chongwe  2018-01-01   426
 4 Kafue    2018-01-01   290
 5 Luangwa  2018-01-01   776
 6 Lusaka   2018-01-01  1248
 7 Rufunsa  2018-01-01  2907
 8 Chilanga 2018-02-01   165
 9 Chirundu 2018-02-01    89
10 Chongwe  2018-02-01   467
# ℹ 291 more rows</code></pre>
</div>
</div>
<p>This approach is readable, but it can quickly clutter up your workspace and take up additional memory. And if you’re trying to use meaningful object names it can get tedious quickly.</p>
<p>You can also nest the functions (one function inside of the another).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>case_data_lusaka_district_months <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(case_data, province <span class="sc">==</span> <span class="st">"Lusaka"</span>, data_type <span class="sc">==</span> <span class="st">"Confirmed"</span>), </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  district, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This doesn’t clutter the workshop or take up unnecessary memory, but it is difficult to read especially since R will interpret these steps from the inside out (first filter, then select).</p>
<p>The last option is to use pipes, a new addition to R. A pipe lets you take the output from one function and input it directly into the next function. By default, this will automatically go into the first argument of the new function. This is useful for stringing together multiple data cleaning steps while maintaining readability and keeping our environment clear. The <code>*tidyverse*</code> package includes a pipe function which looks like <code>%&gt;%</code>. In RStudio, the shortcut for this pipe is Ctrl + Shift + M if you have a PC or Cmd + Shift + M if you have a Mac. You can adjust this shortcut under Tools &gt;&gt; Modify Keyboard Shortcuts…</p>
<p>Here’s an example of using a pipe for combine the filter and select from the previous example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province <span class="sc">==</span> <span class="st">"Lusaka"</span>, data_type <span class="sc">==</span> <span class="st">"Confirmed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(district, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 301 × 3
# Rowwise: 
   district period     count
   &lt;chr&gt;    &lt;date&gt;     &lt;dbl&gt;
 1 Chilanga 2018-01-01   151
 2 Chirundu 2018-01-01   198
 3 Chongwe  2018-01-01   426
 4 Kafue    2018-01-01   290
 5 Luangwa  2018-01-01   776
 6 Lusaka   2018-01-01  1248
 7 Rufunsa  2018-01-01  2907
 8 Chilanga 2018-02-01   165
 9 Chirundu 2018-02-01    89
10 Chongwe  2018-02-01   467
# ℹ 291 more rows</code></pre>
</div>
</div>
<p>In this code, we used a pipe to send <code>case_data</code> into a <code>filter()</code> function and keep the rows for confirmed cases in Lusaka province, then used another pipe to send that output into a <code>select()</code> where we only kept the district, period, and count columns. We didn’t need to explicitly state the data object in the filter and select because data is always the first argument.</p>
<p>You may find it helpful to read the pipe like the word “then”. Take the case, then filter for Lusaka province and confirmed cases, then select the districts, periods, and counts. We can also save this into a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>lusaka_confirmed_cases <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province <span class="sc">==</span> <span class="st">"Lusaka"</span>, data_type <span class="sc">==</span> <span class="st">"Confirmed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(district, period, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<!-- > $\color{red}{\text{Question 6: Using pipes, create a table contain the clincal cases in January 2019 for each district in Southern Province. The table should only have two columns (district and counts)}}$ -->
<!-- > \textcolor{red}{Question 6: Using pipes, create a table contain the clincal cases in January 2019 for each district in Southern Province. The table should only have two columns (district and counts)} -->
<blockquote class="blockquote">
<p>Question 13: Using pipes, create a table contain the confirmed cases in January 2019 for each district in Southern Province. The table should only have two columns (district and counts)</p>
</blockquote>
<section id="grouping-and-summarizing-data" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="grouping-and-summarizing-data"><span class="header-section-number">6.4.1</span> <strong>Grouping and summarizing data</strong></h3>
<p>Another common data manipulation tasks involve grouping data together and applying summary functions such as calculating means or totals. We can do some of these types of operations already. For instance, we can get the total number of clinical cases in Lusaka Province.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lusaka_clinical <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Clinical"</span>, province <span class="sc">==</span> <span class="st">"Lusaka"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(lusaka_clinical<span class="sc">$</span>count, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 68524</code></pre>
</div>
</div>
<p>But what if we want to get summaries for each province at once? We could repeat the steps above, separating each province, calculating the totals, and then grouping these summaries back together. In programming this concept is often referred to as the <strong>split-apply-combine</strong> paradigm. The key <code>*dplyr*</code> functions for these tasks are <code>group_by()</code> and <code>summarize()</code> (you can also use the “proper” <code>summarise()</code> spelling as well).</p>
<p>First, <code>group_by()</code> takes in a column that contains categorical data, then use <code>summarize()</code> to calculate new summary statistics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Tested"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_tested =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   province     mean_tested
   &lt;chr&gt;              &lt;dbl&gt;
 1 Central            8199.
 2 Copperbelt        15741.
 3 Eastern           12389.
 4 Luapula            9217.
 5 Lusaka             5646.
 6 Muchinga           8709.
 7 Northern           7090.
 8 Northwestern      10500.
 9 Southern           1987.
10 Western            5524.
11 &lt;NA&gt;               1234.</code></pre>
</div>
</div>
<p>You can also group by more than one column, and output multiple columns within a single <code>summarize()</code> call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Tested"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province, district, <span class="fu">year</span>(period)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_tested_per_month =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_tested_per_month =</span> <span class="fu">sum</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 466 × 5
# Groups:   province, district [117]
   province district `year(period)` mean_tested_per_month total_tested_per_month
   &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;                 &lt;dbl&gt;                  &lt;dbl&gt;
 1 Central  Chibombo           2018                 8442.                 101301
 2 Central  Chibombo           2019                 7309.                  87711
 3 Central  Chibombo           2020                12910.                 154926
 4 Central  Chibombo           2021                14252.                  99763
 5 Central  Chisamba           2018                 6959.                  83511
 6 Central  Chisamba           2019                 5204                   62448
 7 Central  Chisamba           2020                 5815.                  69776
 8 Central  Chisamba           2021                 5825.                  40773
 9 Central  Chitambo           2018                 4071.                  48855
10 Central  Chitambo           2019                 5620.                  67442
# ℹ 456 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Tested"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province, district, <span class="fu">year</span>(period)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_tested_per_month =</span> <span class="fu">mean</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_tested_per_month =</span> <span class="fu">sum</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 466 × 5
# Groups:   province, district [117]
   province district `year(period)` mean_tested_per_month total_tested_per_month
   &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;                 &lt;dbl&gt;                  &lt;dbl&gt;
 1 Central  Chibombo           2018                 8442.                 101301
 2 Central  Chibombo           2019                 7309.                  87711
 3 Central  Chibombo           2020                12910.                 154926
 4 Central  Chibombo           2021                14252.                  99763
 5 Central  Chisamba           2018                 6959.                  83511
 6 Central  Chisamba           2019                 5204                   62448
 7 Central  Chisamba           2020                 5815.                  69776
 8 Central  Chisamba           2021                 5825.                  40773
 9 Central  Chitambo           2018                 4071.                  48855
10 Central  Chitambo           2019                 5620.                  67442
# ℹ 456 more rows</code></pre>
</div>
</div>
<p>Sometimes it is useful to rearrange the result of our summarized dataset, in which case we can use the <code>arrange()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Tested"</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district, period) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_tested_per_month =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(total_tested_per_month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,396 × 3
# Groups:   district [117]
   district   period     total_tested_per_month
   &lt;chr&gt;      &lt;date&gt;                      &lt;dbl&gt;
 1 Mwandi     2019-10-01                     45
 2 Mwandi     2019-11-01                    144
 3 Mwandi     2019-01-01                    267
 4 Mwandi     2019-09-01                    287
 5 Mwandi     2019-12-01                    292
 6 Shang'ombo 2019-11-01                    312
 7 Pemba      2019-08-01                    319
 8 Shang'ombo 2019-07-01                    348
 9 Shang'ombo 2019-10-01                    369
10 Mwandi     2019-06-01                    389
# ℹ 1,386 more rows</code></pre>
</div>
</div>
<p>By default arranging with be in ascending order, you can use <code>desc()</code> to make the output descending.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">==</span> <span class="st">"Tested"</span>, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">year</span>(period) <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district, period) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_tested_per_month =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_tested_per_month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,396 × 3
# Groups:   district [117]
   district      period     total_tested_per_month
   &lt;chr&gt;         &lt;date&gt;                      &lt;dbl&gt;
 1 Kapiri-Mposhi 2019-03-01                  53173
 2 Kapiri-Mposhi 2019-04-01                  45125
 3 Petauke       2019-04-01                  44856
 4 Kitwe         2019-01-01                  44378
 5 Kapiri-Mposhi 2019-05-01                  40387
 6 Ndola         2019-04-01                  39858
 7 Kitwe         2019-02-01                  39630
 8 Chipangali    2019-04-01                  39166
 9 Solwezi       2019-12-01                  38709
10 Kitwe         2019-03-01                  37622
# ℹ 1,386 more rows</code></pre>
</div>
</div>
<!-- > $\color{red}{\text{Question 6: What were the total number of confirmed cases in each province in 2019?}}$ -->
<!-- > $\color{red}{\text{Question 7: What were the total number of cases (Clinical and Confirmed) in each month for all provinces?}}$ -->
<!-- > $\color{red}{\text{Question 8 (HARD): What were the total number of cases (Clinical and Confirmed) in the rainy and dry seasons for each district in Southern Province?}}$ -->
<!-- > \textcolor{red}{Question 7: What were the total number of confirmed cases in each province in 2019? -->
<!-- > \textcolor{red}{Question 8: What were the total number of cases (Clinical and Confirmed) in each month for all provinces?} -->
<!-- > \textcolor{red}{Question 9 (HARD): What were the total number of cases (Clinical and Confirmed) in the rainy and dry seasons for each district in Southern Province?} -->
<blockquote class="blockquote">
<p>Question 14: What were the total number of confirmed cases in each province in 2019?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 15: What were the total number of cases (Clinical and Confirmed) in each month for all provinces for each year?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 16 (HARD): What were the total number of cases (Clinical and Confirmed) in the peak (dec - may) and the low (june - nov) transmission seasons for each district in Southern Province during the 2019/2020 transmission season (i.e.&nbsp;Dec 2019 - Nov 2020)?</p>
</blockquote>
</section>
</section>
<section id="reshaping-data-with-tidyr" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="reshaping-data-with-tidyr"><span class="header-section-number">6.5</span> <strong>Reshaping data with <code>*tidyr*</code></strong></h2>
<p>So far we have covered a bunch of <code>*dplyr*</code> functions for manipulating data, most of which have changed the number of rows and/or columns in our dataframe. However, even though the columns, rows, and values have changed none of these have changed the “structure” of the dataframe. At the end of each function or piped function, the output always followed the conditions we discussed early:</p>
<ol type="1">
<li>Each column should be a single variable with one data type.</li>
<li>Each row should be a single observation.</li>
<li>Each cell should be a single value contains <strong>one</strong> piece of information.</li>
</ol>
<p>This is commonly referred to as “long” format data, and often this means that there are relatively more rows than columns. Typically it is best to work in “long” format data, especially in R, however there are instances when we may want to change the “shape” of our data into the “wide” format. In Microsoft Excel this would be called creating a Pivot Table.</p>
<p>The <code>*tidyr*</code> package provides functions for reshaping data, including creating “wide” format pivot tables. To illustrate, lets take a look at records for a single district at a single timepoint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">"Chadiza"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
# Rowwise: 
  period     province district data_type             count
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;
1 2020-01-01 Eastern  Chadiza  Confirmed              3986
2 2020-01-01 Eastern  Chadiza  Confirmed_Passive_CHW  7321
3 2020-01-01 Eastern  Chadiza  Tested                 8152
4 2020-01-01 Eastern  Chadiza  Tested_Passive_CHW    12297</code></pre>
</div>
</div>
<p>The resulting table has six rows, because there are six different types of records included. But what if we wanted to create a table where there is a separate column for each type of record? The <code>pivot_wider()</code> function will allow us to create this kind of “wide” format table. This function requires us to state the column which our column names will come from (<code>names_from</code>), and which column the values in the new columns will come from (<code>values_from</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>case_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">"Chadiza"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> data_type, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  period     province district Confirmed Confirmed_Passive_CHW Tested
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;                 &lt;dbl&gt;  &lt;dbl&gt;
1 2020-01-01 Eastern  Chadiza       3986                  7321   8152
# ℹ 1 more variable: Tested_Passive_CHW &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The resulting output just has one row, but new columns for each of the types of records. This “wide” format is often useful for creating summary tables.</p>
<p>The opposite function is called <code>pivot_longer()</code>, which will take in a “wide” format table and output a “long” format table. For <code>pivot_longer()</code> we need to state the column name for the “key” which provides the label, the column names for the values, and which columns we want to pivot on. Here is how we can convert the above example from “wide” format to “long” format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> case_data <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">"Chadiza"</span>, period <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"2020-01-01"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> data_type, <span class="at">values_from =</span> count)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span> </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"data_type"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(Confirmed, Confirmed_Passive_CHW, Tested, </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>             Tested_Passive_CHW))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  period     province district data_type             count
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;
1 2020-01-01 Eastern  Chadiza  Confirmed              3986
2 2020-01-01 Eastern  Chadiza  Confirmed_Passive_CHW  7321
3 2020-01-01 Eastern  Chadiza  Tested                 8152
4 2020-01-01 Eastern  Chadiza  Tested_Passive_CHW    12297</code></pre>
</div>
</div>

<!-- > $\color{red}{\text{Question 10: Create a table that countains the total number of confirmed cases each year for each province, where the rows are the year and there is a column for each province.}}$ -->
<!-- > \textcolor{red}{Question 10: Create a table that countains the total number of confirmed cases each year for each province, where the rows are the year and there is a column for each province.} -->
<blockquote class="blockquote">
<p>Question 17: Create a table that contains the total number of confirmed cases each year for each province, then pivot wider to make it so the rows are the year and there is a column for each province.</p>
</blockquote>
<p>Think of this as a multi-step process<br>
1. Filter for confirmed cases<br>
2. Work out which columns you are grouping by (i.e.&nbsp;what are we grouping over….think geography/time?)<br>
3. Look at the output so far - what do we now want to sum over for our table?<br>
4. Now we need to pivot wider - we want to make new columns - where do those names to come from (names_from)?, where will we find the values to populate the new cells (values_from)?</p>
<blockquote class="blockquote">
<p>Question 17b: Can you make this table longer again, where we now have 3 columns - year, province and count</p>
</blockquote>
<blockquote class="blockquote">
<p>Question 18: Create a table that contains the total number of CHW tests for each district and each year in Luapula Province, now pivot wider to make each district its own column where year is now the row - start by writing out the steps 1 by 1 as above</p>
</blockquote>
</section>
<section id="final-exercises" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="final-exercises"><span class="header-section-number">6.6</span> <strong>Final Exercises</strong></h2>
<blockquote class="blockquote">
<ol type="1">
<li>For each province, calculate the total number of tests conducted by CHWs each year and present as a wide dataframe, where each column is a year and each row is a province and finally, order the dataframe such that the province with the most tests in 2020 is at the top</li>
</ol>
</blockquote>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>For each district in Eastern Province, calculate the test positivity rate at health facilities and by CHWs in 2020 (Test positivity = confirmed cases / total tests)</li>
</ol>
</blockquote>
<p>Tips for Final Exercises 1. Start by filtering your data - what geographical region, year, and data types do we need?<br>
2. Now we need to pivot wider - how can we now have data_type as our column names?<br>
3. Now we need to group_by - what are we grouping by?<br>
4. Almost there!! Now we need to sum up some columns - how can we do this?<br>
5. Now to calculate TPR - let’s use the mutate function<br>
6. Now let’s use the ‘select’ function to retrieve the columns we want</p>
</section>
<section id="function-cheatsheet" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="function-cheatsheet"><span class="header-section-number">6.7</span> <strong>Function cheatsheet</strong></h2>
<ul>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">Main cheat sheet page</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf"><code>*dplyr*</code> cheat sheet link</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf"><code>lubridate</code> cheat sheet</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf"><code>tidyr</code> cheat sheet</a></li>
</ul>
<p><code>*dplyr*</code> functions</p>
<ul>
<li><code>select()</code>: subset columns</li>
<li><code>filter()</code>: subset rows on condition</li>
<li><code>mutate()</code>: create new columns</li>
<li><code>group_by()</code>: group data by one or more column</li>
<li><code>summarise()</code>: create summaries from dataframe (works within groups)</li>
<li><code>arrange()</code>: reorder dataframe based on ascending order (use <code>desc()</code> to invert)</li>
</ul>
<p><code>*tidyr*</code> functions</p>
<ul>
<li><code>pivot_wider()</code>: go from “long” to “wide” format</li>
<li><code>pivot_longer()</code>: go from “wide” to “long” format</li>
</ul>
<p><code>*lubridate*</code> functions</p>
<ul>
<li><code>ymd()</code>: convert class to date object based on “YYYY-MM-DD”</li>
<li><code>year()</code>: return the year from a date input</li>
<li><code>month()</code>: return the month from a date input</li>
<li><code>quarter()</code>: return the year quarter (1,2,3,4) from a date input</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./pipes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chaining multiple steps using pipes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./joins.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joining data in tidyverse</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>